import{h as e,withDirectives as n,vShow as t,resolveDirective as o,defineComponent as a,ref as l,computed as r,openBlock as d,createElementBlock as s,toDisplayString as c,createCommentVNode as u,createElementVNode as i,normalizeClass as p,onBeforeMount as f,onMounted as m,onUnmounted as v,watch as g,warn as h,normalizeStyle as y,renderSlot as b,resolveComponent as x,createBlock as $,Teleport as N,createVNode as D,withCtx as E,nextTick as C,reactive as S,Transition as k,Fragment as O,renderList as z,vModelText as M}from"vue";var R="vue3-tree-org",w="3.1.0";const _=function(e){return"[object Object]"===Object.prototype.toString.call(e)},F=function(e){return"string"==typeof e},B=function(e){return"number"==typeof e},A={print:(e,n,t)=>F(n)||"boolean"==typeof t,pretty:(e,n,t)=>F(n)&&F(e)||"string"==typeof t,primary:(e,n)=>F(e)||"boolean"==typeof n,success:(e,n)=>F(e)||"boolean"==typeof n,info:(e,n)=>F(e)||"boolean"==typeof n,warning:(e,n)=>F(e)||"boolean"==typeof n,danger:(e,n)=>F(e)||"boolean"==typeof n};function T(e="default"){let n="";switch(e){case"primary":n="#2d8cf0";break;case"success":n="#19be6b";break;case"info":n="#909399";break;case"warning":n="#ff9900";break;case"danger":n="#ff4d4f";break;case"default":n="#35495E";break;default:n=e}return n}A.print=function(e,n="default",t=!1){return"object"==typeof e?(console.dir(e),!0):(t?console.log(`%c ${e} `,`background:${T(n)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${e} `,`color: ${T(n)};`),!0)},A.pretty=function(e,n,t="primary"){return console.log(`%c ${e} %c ${n} %c`,`background:${T(t)};border:1px solid ${T(t)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${T(t)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${T(t)};`,"background:transparent"),!0},A.primary=function(e,n=!1){return this.print&&this.print(e,"primary",n),!0},A.success=function(e,n=!1){return this.print&&this.print(e,"success",n),!0},A.info=function(e,n=!1){return this.print&&this.print(e,"info",n),!0},A.warning=function(e,n=!1){return this.print&&this.print(e,"warning",n),!0},A.danger=function(e,n=!1){return this.print&&this.print(e,"danger",n),!0};var L={async install(e){e.config.globalProperties.$log=A,A.pretty("["+R+"] "+w,"success")}};const j=function(e,n,t){const{id:o,children:a}=n;if(e[o]===t)return e;if(Array.isArray(e[a])){const o=e[a];for(let e=0,a=o.length;e<a;e++){const a=o[e],l=j(a,n,t);if(l)return l}}},V=function(e,n){const{parenNode:t,onlyOneNode:o,cloneNodeDrag:a}=n;if(t.value){const{keys:l}=n,{id:r,pid:d}=l,s=t.value.$$data,c=JSON.parse(JSON.stringify(e.$$data));if(a){!function(e,n,t){const{children:o}=n;if(_(e))a(e);else if(Array.isArray(e))for(let n=0,t=e.length;n<t;n++)a(e[n]);function a(e){if(t(e),Array.isArray(e[o])){const n=e[o];for(let e=0,t=n.length;e<t;e++)a(n[e])}}}(c,l,(function(e){"string"==typeof e[r]&&-1!==e[r].indexOf("clone-node")&&(e[r]=`clone-node-${e[r]}`)}));const{children:e}=l;o&&Array.isArray(c[e])&&(c[e]=[]),c[l.pid]=s[l.id],s.children?s.children.push(c):s.children=[c]}else!function(e,n){const{keys:t,data:o,onlyOneNode:a}=n,{id:l,pid:r,children:d}=t,s=j(o,t,e[r]),c=s[d];let u;for(let n=0,t=c.length;n<t;n++)if(c[n][l]===e[l]){c.splice(n,1),u=n;break}const i=e[d];a&&void 0!==u&&i&&(e[d]=[],i.forEach((e=>{e[r]=s[l]})),s[d].splice(u,0,...i))}(c,n),c[d]=s[r],s.children?s.children.push(c):s.children=[].concat(c)}},Y={beforeMount(e,n){const{l:t,t:o}=n.modifiers,{drag:a,dragData:l,node:r,handleStart:d,handleMove:s,handleEnd:c}=n.value,{value:u}=n,i={...l};e.addEventListener("mousedown",(function(e){e.stopPropagation();const n=e.target;if(!1===a||0!==e.button||r.focused||r.noDragging||n.className.indexOf("tree-org-node-btn")>-1)return!1;(function(e){v=e.screenX,g=e.screenY,f=0,i.contextmenu.value=!1;const{keys:n,onlyOneNode:t}=i;if(t){const{children:e}=n;console.log(r,114);const t={...r.$$data};t[e]=[],i.cloneData.value=t}else i.cloneData.value=r.$$data})(e),document.addEventListener("mousemove",h),document.addEventListener("mouseup",y),b("start")}));let p,f=0,m=!1,v=0,g=0;function h(n){return n.preventDefault(),!(Math.abs(n.screenX-v)<5&&Math.abs(n.screenY-g)<5)&&(m||(m=!0,function(n){i.nodeMoving.value=!0,r.moving=!0;let t=e;for(;!t.classList.contains("tree-org-node");)f+=t.offsetLeft,t=t.offsetParent;f+=2,p=document.querySelector("#clone-tree-org"),p&&(p.style.width=`${t.clientWidth}px`,p.style.opacity="0.8",p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px")}(n)),t&&o&&u?(p&&(p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px"),void b("move")):t&&u?(e.style.left=n.clientX-f+"px",void b("move")):void(o&&u&&(e.style.top=n.clientY+"px",b("move"))))}function y(e){if(document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",y),!m)return;m=!1,p=null,r.moving=!1,i.nodeMoving.value=!1;const n=document.querySelector(".tree-org-node__moving");if(n&&n.contains(e.target))return b("end",!0),!1;V(r,i),b("end",!1)}function b(e,n){"start"!==e?"move"!==e?"end"===e&&"function"==typeof c&&c(r,n):"function"==typeof s&&s(r):"function"==typeof d&&d(r)}}};const X={onClick:"onNodeClick",onDblclick:"onNodeDbclick",onContextmenu:"onNodeContextmenu",onMouseenter:"onNodeMouseenter",onMouseleave:"onNodeMouseleave"};function P(e,n){if("function"==typeof e)return function(t){t.target.className.indexOf("org-tree-node-btn")>-1||e(t,n)}}const q=(e,n)=>!(Array.isArray(e[n])&&e[n].length>0)||e.isLeaf,U=(e,o,a)=>{const{attrs:l}=a,r=["tree-org-node"],d=[],{expand:s,$$level:c,children:u,id:i}=o;void 0===s&&c<l.defaultExpandLevel&&(o.expand=!0);const p=o.expand;return q(o,"children")?r.push("is-leaf"):l.collapsable&&!p&&r.push("collapsed"),o.moving&&r.push("tree-org-node__moving"),d.push(W(e,o,a)),l.collapsable&&!p||d.push(K(e,u,a)),n(e("div",{class:r,key:i},d),[[t,!o.hidden]])},W=(e,a,l)=>{const{attrs:r}=l,d=r.props,s=r.renderContent,{label:c}=a,u=[];if(l.slots.default)u.push(l.slots.default({node:a}));else if("function"==typeof s){A.warning("scoped-slot header is easier to use. We recommend users to use scoped-slot header.");const n=s(e,a);n&&u.push(n)}else u.push(c);r.collapsable&&!q(a,"children")&&u.push(((e,n,t)=>{const{attrs:o}=t,a=o.onOnExpand,l=["tree-org-node__expand"];n.expand&&l.push("expanded");const r=[];return t.slots.expand?r.push(t.slots.expand({node:n})):r.push(e("span",{class:"tree-org-node__expand-btn"})),e("span",{class:l,onClick:e=>{e.stopPropagation(),a&&a(e,n)}},r)})(e,a,l));const i=["tree-org-node__inner"];let{labelStyle:p,labelClassName:f,selectedClassName:m,selectedKey:v}=r;"function"==typeof f&&(f=f(a)),f&&i.push(f),a.className&&i.push(a.className),"function"==typeof m&&(m=m(a)),void 0!==v&&(v=Array.isArray(v)?v:[v]),m&&v&&v.includes(a.id)&&i.push(m);const g=["tree-org-node__content"];a.$$root&&g.push("is-root"),a.label||g.push("is-empty"),a.$$focused&&g.push("is-edit");const h=o("nodedrag"),y=[];r.vNodedrag&&h&&!a.$$root&&y.push([h,Object.assign({node:a},r.vNodedrag),"",{l:!0,t:!0}]);const b={};for(const e in X)if(Object.prototype.hasOwnProperty.call(X,e)){const n=r[X[e]];n&&(b[e]=P(n,a))}const x=r.onNodeFocus,$=r.onNodeBlur,N=o("focus"),D=[[t,a.$$focused]];return N&&D.push([N,a.$$focused]),e("div",{class:g},[n(e("div",{class:i,style:a.style?a.style:p,...b},u),y),n(e("textarea",{class:"tree-org-node__textarea",placeholder:"请输入节点名称",value:a.label,onFocus:e=>{x&&x(e,a.$$data,a)},onInput:e=>{a.label=e.target.value},onBlur:e=>{void 0!==a.$$data.focused&&(a.$$data.focused=!1),a.$$data[d.label]=e.target.value,a.$$focused=!1,$&&$(e,a.$$data,a)},onClick:e=>e.stopPropagation()}),D)])},K=(e,n,t)=>{if(Array.isArray(n)&&n.length){const o=n.filter((e=>!e.$$hidden)).map((n=>U(e,n,t)));return e("div",{class:"tree-org-node__children"},o)}return""},I=(n,t)=>n.data?(n.data.$$root=!n.isClone,U(e,n.data,t)):"";I.directives={focus:{mounted(e,{value:n}){n&&e.focus()},updated(e,{value:n}){n&&e.focus()}},nodedrag:Y};var J=a({props:{scale:String,tools:Object},setup(e,{emit:n}){const t=l(!1),o=l(!1);const a=r((()=>t.value?"全部收起":"全部展开")),d=r((()=>o.value?"退出全屏":"全屏"));return{expanded:t,fullscreen:o,expandTitle:a,fullTiltle:d,handleExpand:function(){t.value=!t.value,n("onExpand")},handleScale:function(e){"out"===e?n("onScale",.1):"in"===e?n("onScale",-.1):n("onRestore")},handleFullscreen:function(){o.value=!o.value,n("onFullscreen")}}}});const H={class:"zm-tree-handle"},G={key:0,class:"zm-tree-percent"},Q=["title"],Z={class:"zm-tree-svg"},ee=[i("span",{class:"zm-tree-icon"},"+",-1)],ne=[i("span",{class:"zm-tree-icon"},"-",-1)],te=[i("span",{class:"zm-tree-restore"},null,-1)],oe=["title"],ae={class:"zm-tree-svg"};function le(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}function re(e,n,t,o=1){return{deltaX:Math.round(n/o/e[0])*e[0],deltaY:Math.round(t/o/e[1])*e[1]}}function de(e,n,t){return e<n?n:t<e?t:e}J.render=function(e,n,t,o,a,l){return d(),s("div",H,[e.tools.scale?(d(),s("div",G,c(e.scale),1)):u("v-if",!0),e.tools.expand?(d(),s("div",{key:1,onClick:n[0]||(n[0]=(...n)=>e.handleExpand&&e.handleExpand(...n)),title:e.expandTitle,class:"zm-tree-handle-item"},[i("span",Z,[i("i",{class:p(["iconfont",e.expanded?"icon-collapse":"icon-expand"])},null,2)])],8,Q)):u("v-if",!0),e.tools.zoom?(d(),s("div",{key:2,onClick:n[1]||(n[1]=n=>e.handleScale("out")),title:"放大",class:"zm-tree-handle-item zoom-out"},ee)):u("v-if",!0),e.tools.zoom?(d(),s("div",{key:3,onClick:n[2]||(n[2]=n=>e.handleScale("in")),title:"缩小",class:"zm-tree-handle-item zoom-in"},ne)):u("v-if",!0),e.tools.restore?(d(),s("div",{key:4,onClick:n[3]||(n[3]=n=>e.handleScale("restore")),title:"还原",class:"zm-tree-handle-item"},te)):u("v-if",!0),e.tools.fullscreen?(d(),s("div",{key:5,onClick:n[4]||(n[4]=(...n)=>e.handleFullscreen&&e.handleFullscreen(...n)),title:e.fullTiltle,class:"zm-tree-handle-item"},[i("span",ae,[i("i",{class:p(["iconfont",e.fullscreen?"icon-unfullscreen":"icon-fullscreen"])},null,2)])],8,oe)):u("v-if",!0)])},J.__file="src/components/tools/tools.vue";const se=function(e,n,t,o=!1){e&&n&&t&&e.addEventListener(n,t,o)},ce=function(e,n,t,o=!1){e&&n&&t&&e.removeEventListener(n,t,o)},ue=(e,{emit:n},t)=>{const o={start:"mousedown",move:"mousemove",stop:"mouseup"},a={start:"touchstart",move:"touchmove",stop:"touchend"},d={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},s={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let c=o;const u=l(e.x),i=l(e.y),p=l(e.z),h=l(e.active),y=l(!1),b=l(0),x=l(0),$=l(0),N=l(0),D=l(0),E=l(0);let C={},S={};function k(){C={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},S={minLeft:-1/0,maxLeft:1/0,minRight:-1/0,maxRight:1/0,minTop:-1/0,maxTop:1/0,minBottom:-1/0,maxBottom:1/0}}function O(){if(e.parent){const[e,n]=z();D.value=e||0,E.value=n||0}}function z(){if(e.parent&&t.eleRef.value){const e=window.getComputedStyle(t.eleRef.value.parentNode,null);return[parseInt(e.getPropertyValue("width"),10),parseInt(e.getPropertyValue("height"),10)]}return[0,0]}function M(o){if(o instanceof MouseEvent&&1!==o.which)return;const a=o.target||o.srcElement;if(a&&t.eleRef.value&&t.eleRef.value.contains(a)){if(e.dragCancel&&function(e,n,t){let o=e;const a=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find((e=>o&&le(o[e])))||"";if(!le(o[a]))return!1;do{if(o[a](n))return!0;if(o===t)return!1;o=o.parentNode}while(o);return!1}(a,e.dragCancel,t.eleRef.value))return void(y.value=!1);h.value||(h.value=!0,n("activated"),n("update:active",!0)),e.draggable&&(y.value=!0),o instanceof MouseEvent?(C.mouseX=o.pageX,C.mouseY=o.pageY):(C.mouseX=o.touches[0].pageX,C.mouseY=o.touches[0].pageY),C.left=u.value,C.right=b.value,C.top=i.value,C.bottom=x.value,e.parent&&(S=R()),se(document.documentElement,c.move,_),se(document.documentElement,c.stop,F)}}function R(){const n=e.grid;return{minLeft:u.value%n[0],maxLeft:Math.floor((D.value-$.value-u.value)/n[0])*n[0]+u.value,minRight:b.value%n[0],maxRight:Math.floor((D.value-$.value-b.value)/n[0])*n[0]+b.value,minTop:i.value%n[1],maxTop:Math.floor((E.value-N.value-i.value)/n[1])*n[1]+i.value,minBottom:x.value%n[1],maxBottom:Math.floor((E.value-N.value-x.value)/n[1])*n[1]+x.value}}function w(o){const a=o.target||o.srcElement;t.eleRef.value&&!t.eleRef.value.contains(a)&&h.value&&!e.preventDeactivation&&(h.value=!1,n("deactivated"),n("update:active",!1))}function _(t){y.value&&function(t){const o=e.axis,a=e.grid;let l=0,r=0;t instanceof MouseEvent?(l=t.pageX,r=t.pageY):(l=t.touches[0].pageX,r=t.touches[0].pageY);const d=o&&"y"!==o?C.mouseX-l:0,s=o&&"x"!==o?C.mouseY-r:0,{deltaX:c,deltaY:p}=re(a,d,s,e.scale),f=de(C.left-c,S.minLeft,S.maxLeft),m=de(C.top-p,S.minTop,S.maxTop),v=de(C.right+c,S.minRight,S.maxRight),g=de(C.bottom+p,S.minBottom,S.maxBottom);u.value=f,i.value=m,b.value=v,x.value=g,n("dragging",u.value,i.value)}(t)}function F(){k(),y.value&&(y.value=!1,n("dragstop",u.value,i.value))}f((()=>{k()})),m((()=>{!e.enableNativeDrag&&t.eleRef.value&&(t.eleRef.value.ondragstart=()=>!1);const[n,o]=z();if(D.value=n,E.value=o,t.eleRef.value){const[e,n]=function(e){const n=window.getComputedStyle(e);return[parseFloat(n.getPropertyValue("width")),parseFloat(n.getPropertyValue("height"))]}(t.eleRef.value);$.value=e,N.value=n,b.value=D.value-$.value-u.value,x.value=E.value-N.value-i.value}se(document.documentElement,"mousedown",w),se(document.documentElement,"touchend touchcancel",w),se(window,"resize",O)})),v((()=>{ce(document.documentElement,"mousedown",w),ce(document.documentElement,"touchstart",F),ce(document.documentElement,"mousemove",_),ce(document.documentElement,"touchmove",_),ce(document.documentElement,"mouseup",F),ce(document.documentElement,"touchend touchcancel",w),ce(window,"resize",O)}));const B=r((()=>({transform:`translate(${u.value}px, ${i.value}px)`,zIndex:p.value,...y.value&&e.disableUserSelect?d:s})));return g((()=>e.active),(e=>{h.value=e,n(e?"activated":"deactivated")})),g((()=>e.z),(e=>{(e>=0||"auto"===e)&&(p.value=e)})),g((()=>e.x),(n=>{y.value||(e.parent&&(S=R()),function(n){const{deltaX:t}=re(e.grid,n,i.value,e.scale),o=de(t,S.minLeft,S.maxLeft);u.value=o,b.value=D.value-$.value-o}(n))})),g((()=>e.y),(n=>{y.value||(e.parent&&(S=R()),function(n){const{deltaY:t}=re(e.grid,u.value,n,e.scale),o=de(t,S.minTop,S.maxTop);i.value=o,x.value=E.value-N.value-o}(n))})),{enabled:h,dragging:y,style:B,resetBoundsAndMouseState:k,elementTouchDown:function(e){c=a,M(e)},elementMouseDown:function(e){c=o,M(e)}}};"production"===process.env.NODE_ENV||Object.freeze({}),"production"===process.env.NODE_ENV||Object.freeze([]);const ie=Symbol("wrapper");function pe(e,n){if(null===(t=e)||"object"!=typeof t||e.__elPropsReservedKey)return e;var t;const{values:o,required:a,default:l,type:r,validator:d}=e,s=o||d?e=>{let t=!1,a=[];if(o&&(a=[...o,l],t=t||a.includes(e)),d&&(t=t||d(e)),!t&&a.length>0){const t=[...new Set(a)].map((e=>JSON.stringify(e))).join(", ");h(`Invalid prop: validation failed${n?` for prop "${n}"`:""}. Expected one of [${t}], got value ${JSON.stringify(e)}.`)}return t}:void 0;return{type:"object"==typeof r&&Object.getOwnPropertySymbols(r).includes(ie)?r[ie]:r,validator:s,__elPropsReservedKey:!0,default:l,required:!!a}}const fe=e=>function(e){let n=-1;const t=e?e.length:0,o={};for(;++n<t;){const t=e[n];o[t[0]]=t[1]}return o}(Object.entries(e).map((([e,n])=>[e,pe(n,e)]))),me=e=>({[ie]:e});var ve=a({replace:!0,name:"Draggable",props:fe({className:{type:String,default:"zm-draggable"},classNameDraggable:{type:String,default:"draggable"},classNameDragging:{type:String,default:"dragging"},classNameActive:{type:String,default:"active"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:e=>"string"==typeof e?"auto"===e:e>=0},dragCancel:String,axis:{type:String,default:"both",validator:e=>["x","y","both"].includes(e)},grid:{type:Array,default:()=>[1,1]},parent:{type:Boolean,default:!1},scale:{type:Number,default:1,validator:e=>e>0}}),emits:{activated:()=>!0,deactivated:()=>!0,dragging:(e,n)=>B(e)&&B(n),dragstop:(e,n)=>B(e)&&B(n),"update:active":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=ue(e,n,{eleRef:t});return{top:top,eleRef:t,...o}}});ve.render=function(e,n,t,o,a,l){return d(),s("div",{style:y(e.style),class:p([{[e.classNameActive]:e.enabled,[e.classNameDragging]:e.dragging,[e.classNameDraggable]:e.draggable},e.className]),ref:"eleRef",onMousedown:n[0]||(n[0]=(...n)=>e.elementMouseDown&&e.elementMouseDown(...n)),onTouchstart:n[1]||(n[1]=(...n)=>e.elementTouchDown&&e.elementTouchDown(...n))},[b(e.$slots,"default")],38)},ve.__file="src/components/draggable/src/draggable.vue";var ge=a({components:{TreeOrgNode:I},props:fe({data:{type:Object,required:!0},props:{type:me(Object)},modelValue:Boolean,horizontal:Boolean,selectedKey:String,collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]}})});const he={id:"clone-tree-org",class:"clone-tree-org tree-org"};ge.render=function(e,o,a,l,r,s){const c=x("tree-org-node");return d(),$(N,{to:"body"},[n(i("div",he,[D(c,{data:e.data,props:e.props,isClone:!1,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,labelClassName:e.labelClassName},{default:E((({node:n})=>[b(e.$slots,"default",{node:n})])),expand:E((({node:n})=>[b(e.$slots,"expand",{node:n})])),_:3},8,["data","props","horizontal","labelStyle","collapsable","renderContent","labelClassName"])],512),[[t,e.modelValue]])])},ge.__file="src/components/clone-org/clone-org.vue";const ye=(e,{emit:n},t)=>{const o=l("");function a(e,n,t){if(e[n]===t)return e;if(Array.isArray(e.children)){const o=e.children;for(let e=0,l=o.length;e<l;e++){const l=a(o[e],n,t);if(l)return l}}}function d(){const{props:t,data:o,node:l}=e;if(e.nodeDelete)return void e.nodeDelete(l.$$data);if(l.$$root)return void A.pretty("[提示] ","根节点不允许删除","danger");const{id:r,children:d}=t,s=a(o,r,l.pid);if(s){const e=s[d];for(let t=0,o=e.length;t<o;t++)if(e[t][r]===l.id){e.splice(t,1),n("onNodeDelete",l.$$data,l);break}}}function s(){const{nodeEdit:t,node:o}=e;t?t(o.$$data):(o.$$focused=!0,n("onNodeFocus",o.$$data))}function c(o){if(e.modelValue){if(t.eleRef.value&&t.eleRef.value.contains(o.target))return!1;n("update:modelValue",!1)}}const u=r((()=>({left:`${e.x}px`,top:`${e.y}px`}))),i=r((()=>!e.disabled&&!e.node.disabled));return m((()=>{document.addEventListener("mousedown",c)})),v((()=>{document.removeEventListener("mousedown",c)})),{position:u,editable:i,handleMenu:function(a){const l=a.target;if("zm-tree-menu-item"===l.className){const a=l.getAttribute("action");switch(a){case"copy":!function(){if(e.nodeCopy)return void e.nodeCopy(e.node.$$data);o.value=e.node.label,C((()=>{t.inputRef&&t.inputRef.value&&(t.inputRef&&t.inputRef.value.select(),navigator.clipboard.writeText(o.value).then((function(){A.pretty("[提示] ","文本复制成功","success")}),(function(){A.pretty("[错误] ","浏览器不支持","danger")})),n("onNodeCopy",o.value))}))}();break;case"add":!function(){if(e.nodeAdd)return void e.nodeAdd(e.node.$$data);const{id:t,pid:o,label:a,expand:l,children:r}=e.props,{node:d}=e,s={[t]:String((new Date).getTime()),[o]:d.id,[a]:"",[l]:!1,[r]:[],newNode:!0,focused:!0};Array.isArray(d.children)?d.$$data[r].push(s):d.$$data[r]=[s];n("onNodeFocus",s)}();break;case"edit":s();break;case"delete":d()}n("contextmenu",{command:a,node:e.node,data:e.node.$$data}),n("update:modelValue",!1)}},handleEdit:s,handleClose:c,afterEnter:function(){n("opened")},afterLeave:function(){n("closed")}}};var be=a({name:"Contextmenu",props:fe({modelValue:{type:Boolean,required:!0},data:{type:Object,required:!0},node:{type:me(Object),required:!0},props:{type:me(Object)},x:Number,y:Number,menus:{type:me(Array)},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,disabled:Boolean}),emits:{onNodeDelete:(e,n)=>_(e)&&_(n),onNodeCopy:e=>F(e),contextmenu:e=>_(e),onNodeFocus:e=>_(e),opened:()=>!0,closed:()=>!0,"update:modelValue":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=l();return{eleRef:o,inputRef:t,copyText:l(""),oldData:S({}),...ye(e,n,{inputRef:t,eleRef:o})}}});const xe=["action"];be.render=function(e,o,a,l,r,p){return d(),$(N,{to:"body"},[D(k,{name:"dialog-fade",onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave},{default:E((()=>[n(i("div",{style:y(e.position),onClick:o[1]||(o[1]=(...n)=>e.handleMenu&&e.handleMenu(...n)),ref:"eleRef",class:"zm-tree-contextmenu"},[i("ul",null,[(d(!0),s(O,null,z(e.menus,(n=>(d(),s(O,null,[e.editable||!["add","edit","delete"].includes(n.command)?(d(),s("li",{class:"zm-tree-menu-item",action:n.command,key:n.command},c(n.name),9,xe)):u("v-if",!0)],64)))),256))]),n(i("textarea",{class:"copy-textarea",ref:"inputRef","onUpdate:modelValue":o[0]||(o[0]=n=>e.copyText=n)},null,512),[[M,e.copyText]])],4),[[t,e.modelValue]])])),_:1},8,["onAfterEnter","onAfterLeave"])])},be.__file="src/components/contextmenu/src/contextmenu.vue";const $e=[{name:"复制文本",command:"copy"},{name:"新增节点",command:"add"},{name:"编辑节点",command:"edit"},{name:"删除节点",command:"delete"}],Ne=fe({data:{type:Object,required:!0},props:{type:me(Object),default:()=>({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"})},toolBar:{type:[Object,Boolean],default:()=>({expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0})},disabled:{type:Boolean,default:!1},scalable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},draggableOnNode:{type:Boolean,default:!1},nodeDraggable:{type:Boolean,default:!0},cloneNodeDrag:{type:Boolean,default:!0},onlyOneNode:{type:Boolean,default:!0},clickDelay:{type:Number,default:260},defaultExpandLevel:Number,nodeDragStart:Function,nodeDraging:Function,nodeDragEnd:Function,horizontal:Boolean,selectedKey:{type:[Array,String,Number]},collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]},selectedClassName:{type:[Function,String]},defineMenus:{type:me(Array),default:()=>$e},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,filterNodeMethod:Function}),De=(e,{emit:n},t)=>{const o=l(0),a=l(0),d=l(!1);function s(e,n){const l=t.zoomRef.value,r=t.treeRef.value,d=l.clientWidth/2,s=l.clientHeight/2;let c=l.clientHeight-r.clientHeight,u=l.clientWidth-r.clientWidth;c>0&&(c=0),u>0&&(u=0),o.value=e>d?d:e<u?u:e,a.value=n<c?c:n>s?s:n}function c(e,t){s(e,t),n("on-drag-stop",{x:e,y:t})}const u=l(!1),i=S({value:{}});const p=l(!1),m=l(0),v=l(0),h=l({});const y=l(1);function b(n){if(!e.scalable)return;const t=Number((Number(y.value)+n).toFixed(1));y.value=n>0?Math.min(3,t):Math.max(.3,t)}function x(e,n,t){d.value=!0;const l=e.offsetLeft-n,r=e.offsetTop-t;o.value-=l,a.value-=r,s(o.value,a.value)}let $;const N=S(Object.assign({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"},e.props));const D=l(!1);function E(e){const{expand:n,children:t}=N;e.forEach((e=>{e[n]&&(e[n]=!1),e[t]&&E(e[t])}))}const k=l(!1);function O(e,n){Array.isArray(e)?e.forEach((e=>{e.expand=n,e.children&&O(e.children,n)})):(e.expand=n,e.children&&O(e.children,n))}function z(e){L.value=T(e)}const M=r((()=>({width:100/y.value+"%",height:100/y.value+"%",transform:`scale(${y.value})`}))),R=r((()=>`${Math.round(100*y.value)}%`)),w=r((()=>e.draggableOnNode||!e.nodeDraggable?"":".tree-org-node-label")),_=r((()=>k.value?"收起全部节点":"展开全部节点")),F=r((()=>k.value?"收起全部节点":"展开全部节点")),B=l({}),A=r((()=>{const{cloneNodeDrag:n,onlyOneNode:t,data:o}=e;return{drag:e.nodeDraggable,dragData:{keys:N,nodeMoving:u,parenNode:i,cloneNodeDrag:n,onlyOneNode:t,contextmenu:p,cloneData:B,data:o},handleStart:e.nodeDragStart,handleMove:e.nodeDraging,handleEnd:e.nodeDragEnd}}));function T(e){const n=(e,t)=>{const{id:o,label:a,pid:l,expand:r,children:d}=N,s={};Object.keys(e).map((n=>{["hidden","disabled","className","style"].includes(n)&&(s[n]=e[n])}));const c=e[d],u=t+1;return{...s,id:e[o],label:e[a],pid:e[l],expand:e[r],children:c?c.map((e=>n(e,u))):void 0,$$level:t,$$data:e,$$focused:e.focused||!1}};return n(e,0)}g((()=>e.horizontal),(()=>{C((()=>{c(o.value,a.value)}))}));const L=l(T(e.data));g((()=>e.data),(()=>{z(e.data)}),{deep:!0});const j=S({visible:!0,data:{expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0}});return f((()=>{"object"==typeof e.toolBar?Object.assign(j.data,e.toolBar):e.toolBar||(j.visible=!1)})),{keys:N,left:o,top:a,menuX:m,menuY:v,nodeMoving:u,zoomStyle:M,tools:j,zoomPercent:R,dragCancel:w,expandTitle:_,fullTiltle:F,nodeargs:A,expanded:k,fullscreen:D,treeData:L,autoDragging:d,contextmenu:p,menuData:h,cloneData:B,filter:function(n){const t=e.filterNodeMethod;if(!t)throw new Error("[Tree] filterNodeMethod is required when filter");const o=function(e){const a=e.children||[];if(a.forEach((e=>{e.$$hidden=!t.call(e,n,e),o(e)})),e.$$hidden&&a.length){let n=!0;n=a.some((e=>!e.$$hidden)),e.$$hidden=!n}n&&!e.$$hidden&&e.children&&(e.expand=!0)};o(L.value)},setData:z,zoomWheel:function(t){e.scalable&&(t.preventDefault(),t.deltaY<0?b(.1):b(-.1),n("on-zoom",y.value))},onDrag:function(e,t){d.value=!1,o.value=e,a.value=t,n("on-drag",{x:e,y:t})},onDragStop:c,expandChange:function(){k.value=!k.value,O(L.value,k.value),k.value||C((()=>{c(o.value,a.value)}))},handleFullscreen:function(){D.value=!D.value,D.value?function(){const e=t.eleRef.value;e.requestFullscreen&&e.requestFullscreen()}():document.exitFullscreen&&document.exitFullscreen()},zoomOrgchart:b,restoreOrgchart:function(){y.value=1,o.value=0,a.value=0},handleExpand:function(e,t){e.stopPropagation();const o=document.querySelector(".is-root");if(o){const a=o.offsetLeft,l=o.offsetTop;t.expand=!t.expand,!t.expand&&t.children&&E(t.children),C((()=>{x(o,a,l)})),n("on-expand",e,t.$$data,t)}},nodeMouseenter:function(e,t){return u.value&&(i.value=t),n("on-node-mouseenter",e,t.$$data,t),!0},nodeMouseleave:function(e,t){return u.value&&(i.value=null),n("on-node-mouseleave",e,t.$$data,t),!0},nodeContextmenu:function(e,n){e.stopPropagation(),e.preventDefault(),p.value=!0,m.value=e.clientX,v.value=e.clientY,h.value=n},handleBlur:function(e,t,o){const{id:a,label:l}=N,r=h.value.children||[];for(let e=r.length;e>0;e--){const n=r[e-1];if(""===n[a]&&""===n[l]){r.splice(e-1,1);break}}n("on-node-blur",e,t,o)},handleClick:function(t,o){clearTimeout($),$=setTimeout((()=>{n("on-node-click",t,o.$$data,o)}),e.clickDelay)},handleDblclick:function(e,t){clearTimeout($),n("on-node-dblclick",e,t.$$data,t)}}};var Ee=a({name:"vue3TreeOrg",components:{Tools:J,CloneOrg:ge,Draggable:ve,Contextmenu:be,TreeOrgNode:I},directives:{nodedrag:Y},props:Ne,emits:{"on-drag":({x:e,y:n})=>B(e)&&B(n),"on-drag-stop":({x:e,y:n})=>B(e)&&B(n),"on-zoom":e=>B(e),"on-expand":(e,n,t)=>e instanceof MouseEvent&&_(t)&&_(n),"on-node-blur":(e,n,t)=>e instanceof FocusEvent&&_(t)&&_(n),"on-node-click":(e,n,t)=>e instanceof MouseEvent&&_(t)&&_(n),"on-node-dblclick":(e,n,t)=>e instanceof MouseEvent&&_(t)&&_(n),"on-node-mouseenter":(e,n,t)=>e instanceof MouseEvent&&_(t)&&_(n),"on-node-mouseleave":(e,n,t)=>e instanceof MouseEvent&&_(t)&&_(n),"on-contextmenu":e=>_(e),"on-node-copy":e=>F(e),"on-node-delete":e=>_(e),"on-node-focus":(e,n,t)=>e instanceof FocusEvent&&_(t)&&_(n)},setup(e,n){const t=l(),o=l(),a=l();return{eleRef:t,treeRef:o,zoomRef:a,...De(e,n,{eleRef:t,treeRef:o,zoomRef:a})}}});const Ce={ref:"eleRef",class:"zm-tree-org"},Se={class:"tree-org-node__text"},ke=i("span",{class:"tree-org-node__expand-btn"},null,-1),Oe={class:"tree-org-node__text"},ze=i("span",{class:"tree-org-node__expand-btn"},null,-1);Ee.render=function(e,n,t,o,a,l){const r=x("tree-org-node"),f=x("Draggable"),m=x("Tools"),v=x("clone-org"),g=x("Contextmenu");return d(),s("div",Ce,[i("div",{ref:"zoomRef",class:"zoom-container",style:y(e.zoomStyle),onWheel:n[1]||(n[1]=(...n)=>e.zoomWheel&&e.zoomWheel(...n))},[D(f,{x:e.left,y:e.top,class:p({dragging:e.autoDragging}),onDragging:e.onDrag,onDragstop:e.onDragStop,draggable:e.draggable,"drag-cancel":e.dragCancel},{default:E((()=>[i("div",{ref:"treeRef",class:p(["tree-org",{horizontal:e.horizontal,collapsable:e.collapsable}])},[D(r,{data:e.treeData,props:e.keys,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,selectedKey:e.selectedKey,defaultExpandLevel:e.defaultExpandLevel,selectedClassName:e.selectedClassName,labelClassName:e.labelClassName,vNodedrag:e.nodeargs,onOnExpand:e.handleExpand,onNodeClick:e.handleClick,onNodeDblclick:e.handleDblclick,onNodeMouseenter:e.nodeMouseenter,onNodeMouseleave:e.nodeMouseleave,onNodeContextmenu:e.nodeContextmenu,onNodeFocus:n[0]||(n[0]=(n,t,o)=>{e.$emit("on-node-focus",n,t,o)}),onNodeBlur:e.handleBlur},{default:E((({node:n})=>[b(e.$slots,"default",{node:n},(()=>[i("div",Se,[i("span",null,c(n.label),1)])]))])),expand:E((({node:n})=>[b(e.$slots,"expand",{node:n},(()=>[ke]))])),_:3},8,["data","props","horizontal","labelStyle","collapsable","renderContent","selectedKey","defaultExpandLevel","selectedClassName","labelClassName","vNodedrag","onOnExpand","onNodeClick","onNodeDblclick","onNodeMouseenter","onNodeMouseleave","onNodeContextmenu","onNodeBlur"])],2)])),_:3},8,["x","y","class","onDragging","onDragstop","draggable","drag-cancel"])],36),e.tools.visible?(d(),$(m,{key:0,tools:e.tools.data,scale:e.zoomPercent,onOnExpand:e.expandChange,onOnScale:e.zoomOrgchart,onOnRestore:e.restoreOrgchart,onOnFullscreen:e.handleFullscreen},null,8,["tools","scale","onOnExpand","onOnScale","onOnRestore","onOnFullscreen"])):u("v-if",!0),e.nodeDraggable?(d(),$(v,{key:1,modelValue:e.nodeMoving,"onUpdate:modelValue":n[2]||(n[2]=n=>e.nodeMoving=n),props:e.keys,data:e.cloneData,horizontal:e.horizontal,"label-style":e.labelStyle,collapsable:e.collapsable,"render-content":e.renderContent,"label-class-name":e.labelClassName},{default:E((({node:n})=>[b(e.$slots,"default",{node:n},(()=>[i("div",Oe,[i("span",null,c(n[e.keys.label]),1)])]))])),expand:E((({node:n})=>[b(e.$slots,"expand",{node:n},(()=>[ze]))])),_:3},8,["modelValue","props","data","horizontal","label-style","collapsable","render-content","label-class-name"])):u("v-if",!0),e.defineMenus.length?(d(),$(g,{key:2,modelValue:e.contextmenu,"onUpdate:modelValue":n[3]||(n[3]=n=>e.contextmenu=n),x:e.menuX,y:e.menuY,node:e.menuData,data:e.data,props:e.keys,menus:e.defineMenus,disabled:e.disabled,"node-add":e.nodeAdd,"node-delete":e.nodeDelete,"node-edit":e.nodeEdit,"node-copy":e.nodeCopy,onContextmenu:n[4]||(n[4]=n=>{e.$emit("on-contextmenu",n)}),onOnNodeCopy:n[5]||(n[5]=n=>{e.$emit("on-node-copy",n)}),onOnNodeDelete:n[6]||(n[6]=n=>{e.$emit("on-node-delete",n)})},null,8,["modelValue","x","y","node","data","props","menus","disabled","node-add","node-delete","node-edit","node-copy"])):u("v-if",!0)],512)},Ee.__file="src/components/tree-org/src/tree.vue",Ee.install=function(e){e.component(Ee.name,Ee)};const Me=[Ee];var Re={install:function(e){Me.forEach((n=>{e.component(n.name,n)})),e.use(L)},Vue3TreeOrg:Ee};export{Ee as Vue3TreeOrg,Re as default};
