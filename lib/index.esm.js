import{withDirectives as e,vShow as n,resolveDirective as t,h as o,defineComponent as a,ref as l,computed as r,openBlock as d,createElementBlock as s,toDisplayString as c,createCommentVNode as u,createElementVNode as i,normalizeClass as p,onBeforeMount as f,onMounted as m,onUnmounted as v,watch as g,warn as y,normalizeStyle as h,renderSlot as b,resolveComponent as x,createBlock as N,Teleport as $,createVNode as D,withCtx as C,nextTick as E,reactive as S,Transition as O,Fragment as k,renderList as z,vModelText as M}from"vue";var R="vue3-tree-org",_="3.0.1";const w=function(e){return"[object Object]"===Object.prototype.toString.call(e)},F=function(e){return"string"==typeof e},B=function(e){return"number"==typeof e},A={print:(e,n,t)=>F(n)||"boolean"==typeof t,pretty:(e,n,t)=>F(n)&&F(e)||"string"==typeof t,primary:(e,n)=>F(e)||"boolean"==typeof n,success:(e,n)=>F(e)||"boolean"==typeof n,info:(e,n)=>F(e)||"boolean"==typeof n,warning:(e,n)=>F(e)||"boolean"==typeof n,danger:(e,n)=>F(e)||"boolean"==typeof n};function T(e="default"){let n="";switch(e){case"primary":n="#2d8cf0";break;case"success":n="#19be6b";break;case"info":n="#909399";break;case"warning":n="#ff9900";break;case"danger":n="#ff4d4f";break;case"default":n="#35495E";break;default:n=e}return n}A.print=function(e,n="default",t=!1){return"object"==typeof e?(console.dir(e),!0):(t?console.log(`%c ${e} `,`background:${T(n)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${e} `,`color: ${T(n)};`),!0)},A.pretty=function(e,n,t="primary"){return console.log(`%c ${e} %c ${n} %c`,`background:${T(t)};border:1px solid ${T(t)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${T(t)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${T(t)};`,"background:transparent"),!0},A.primary=function(e,n=!1){return this.print&&this.print(e,"primary",n),!0},A.success=function(e,n=!1){return this.print&&this.print(e,"success",n),!0},A.info=function(e,n=!1){return this.print&&this.print(e,"info",n),!0},A.warning=function(e,n=!1){return this.print&&this.print(e,"warning",n),!0},A.danger=function(e,n=!1){return this.print&&this.print(e,"danger",n),!0};var j={async install(e){e.config.globalProperties.$log=A,A.pretty("["+R+"] "+_,"success")}};const L=function(e,n,t){const{id:o,children:a}=n;if(e[o]===t)return e;if(Array.isArray(e[a])){const o=e[a];for(let e=0,a=o.length;e<a;e++){const a=o[e],l=L(a,n,t);if(l)return l}}},V=function(e,n){const{parenNode:t,onlyOneNode:o,cloneNodeDrag:a}=n;if(t.value){const{keys:l}=n,{id:r,pid:d}=l,s=t.value.$$data,c=JSON.parse(JSON.stringify(e.$$data));if(a){!function(e,n,t){const{children:o}=n;if(w(e))a(e);else if(Array.isArray(e))for(let n=0,t=e.length;n<t;n++)a(e[n]);function a(e){if(t(e),Array.isArray(e[o])){const n=e[o];for(let e=0,t=n.length;e<t;e++)a(n[e])}}}(c,l,(function(e){"string"==typeof e[r]&&-1!==e[r].indexOf("clone-node")&&(e[r]=`clone-node-${e[r]}`)}));const{children:e}=l;o&&Array.isArray(c[e])&&(c[e]=[]),c[l.pid]=s[l.id],s.children?s.children.push(c):s.children=[c]}else!function(e,n){const{keys:t,data:o,onlyOneNode:a}=n,{id:l,pid:r,children:d}=t,s=L(o,t,e[r]),c=s[d];let u;for(let n=0,t=c.length;n<t;n++)if(c[n][l]===e[l]){c.splice(n,1),u=n;break}const i=e[d];a&&void 0!==u&&i&&(e[d]=[],i.forEach((e=>{e[r]=s[l]})),s[d].splice(u,0,...i))}(c,n),c[d]=s[r],s.children?s.children.push(c):s.children=[].concat(c)}},Y={beforeMount(e,n){const{l:t,t:o}=n.modifiers,{drag:a,dragData:l,node:r,handleStart:d,handleMove:s,handleEnd:c}=n.value,{value:u}=n,i={...l};e.addEventListener("mousedown",(function(e){e.stopPropagation();const n=e.target;if(!1===a||0!==e.button||r.focused||r.noDragging||n.className.indexOf("tree-org-node-btn")>-1)return!1;(function(e){v=e.screenX,g=e.screenY,f=0,i.contextmenu.value=!1;const{keys:n,onlyOneNode:t}=i;if(t){const{children:e}=n;console.log(r,114);const t={...r.$$data};t[e]=[],i.cloneData.value=t}else i.cloneData.value=r.$$data})(e),document.addEventListener("mousemove",y),document.addEventListener("mouseup",h),b("start")}));let p,f=0,m=!1,v=0,g=0;function y(n){return n.preventDefault(),!(Math.abs(n.screenX-v)<5&&Math.abs(n.screenY-g)<5)&&(m||(m=!0,function(n){i.nodeMoving.value=!0,r.moving=!0;let t=e;for(;!t.classList.contains("tree-org-node");)f+=t.offsetLeft,t=t.offsetParent;f+=2,p=document.querySelector("#clone-tree-org"),p&&(p.style.width=`${t.clientWidth}px`,p.style.opacity="0.8",p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px")}(n)),t&&o&&u?(p&&(p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px"),void b("move")):t&&u?(e.style.left=n.clientX-f+"px",void b("move")):void(o&&u&&(e.style.top=n.clientY+"px",b("move"))))}function h(e){if(document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",h),!m)return;m=!1,p=null,r.moving=!1,i.nodeMoving.value=!1;const n=document.querySelector(".tree-org-node__moving");if(n&&n.contains(e.target))return b("end",!0),!1;V(r,i),b("end",!1)}function b(e,n){"start"!==e?"move"!==e?"end"===e&&"function"==typeof c&&c(r,n):"function"==typeof s&&s(r):"function"==typeof d&&d(r)}}};const X={onClick:"onNodeClick",onDblclick:"onNodeDbclick",onContextmenu:"onNodeContextmenu",onMouseenter:"onNodeMouseenter",onMouseleave:"onNodeMouseleave"};function P(e,n){if("function"==typeof e)return function(t){t.target.className.indexOf("org-tree-node-btn")>-1||e(t,n)}}const q=(e,n)=>!(Array.isArray(e[n])&&e[n].length>0),U=(e,n,t)=>{const{id:o,label:a,pid:l,expand:r,children:d}=t.attrs.props;let s={};return Object.keys(e).map((n=>{["hidden","disabled","className","style"].includes(n)&&(s[n]=e[n])})),{...s,id:e[o],label:e[a],pid:e[l],expand:e[r],children:e[d],$$level:n,$$data:e,$$focused:t.attrs.focused===e[o]}},W=(t,o,a,l)=>{const{attrs:r}=a,d=["tree-org-node"],s=[],{expand:c,$$level:u,children:i,id:p}=o;void 0===c&&u<r.defaultExpandLevel&&(o.expand=!0);const f=o.expand;return q(o,"children")?d.push("is-leaf"):r.collapsable&&!f&&d.push("collapsed"),o.moving&&d.push("tree-org-node__moving"),s.push(K(t,o,a,l)),r.collapsable&&!f||s.push(I(t,i,a,u)),e(t("div",{class:d,key:p},s),[[n,!o.hidden]])},K=(o,a,l,r)=>{const{attrs:d}=l,s=d.props,{label:c}=a,u=d.renderContent,i=[];if(l.slots.default)i.push(l.slots.default({node:a}));else if("function"==typeof u){A.warning("scoped-slot header is easier to use. We recommend users to use scoped-slot header.");const e=u(o,a);e&&i.push(e)}else i.push(c);d.collapsable&&!q(a,"children")&&i.push(((e,n,t)=>{const{attrs:o}=t,a=o.onOnExpand,l=["tree-org-node__expand"];n.expand&&l.push("expanded");const r=[];return t.slots.expand?r.push(t.slots.expand({node:n})):r.push(e("span",{class:"tree-org-node__expand-btn"})),e("span",{class:l,onClick:e=>{e.stopPropagation(),a&&a(e,n)}},r)})(o,a,l));const p=["tree-org-node__inner"];let{labelStyle:f,labelClassName:m,selectedClassName:v,selectedKey:g}=d;"function"==typeof m&&(m=m(a)),m&&p.push(m),a.className&&p.push(a.className),"function"==typeof v&&(v=v(a)),void 0!==g&&(g=Array.isArray(g)?g:[g]),v&&g&&g.includes(a[s.id])&&p.push(v);const y=["tree-org-node__content"];r&&y.push("is-root"),a.label||y.push("is-empty"),a.focused&&y.push("is-edit");const h=t("nodedrag"),b=[];d.vNodedrag&&h&&!r&&b.push([h,Object.assign({node:a},d.vNodedrag),"",{l:!0,t:!0}]);const x={};for(const e in X)if(Object.prototype.hasOwnProperty.call(X,e)){const n=d[X[e]];n&&(x[e]=P(n,a))}const N=d.onNodeFocus,$=d.onNodeBlur,D=t("focus"),C=[[n,a.$$focused]];return D&&C.push([D,a.focused]),o("div",{class:y},[e(o("div",{class:p,style:a.style?a.style:f,...x},i),b),e(o("textarea",{class:"tree-org-node__textarea",placeholder:"请输入节点名称",value:a.label,onFocus:e=>N&&N(e,a),onInput:e=>{a.$$data.label=e.target.value},onBlur:e=>{a.focused=!1,$&&$(e,a)},onClick:e=>e.stopPropagation()}),C)])},I=(e,n,t,o)=>{if(Array.isArray(n)&&n.length){const a=n.map((n=>{const a=U(n,o+1,t);return W(e,a,t,!1)}));return e("div",{class:"tree-org-node__children"},a)}return""},J=(e,n)=>{if(!e.data)return"";const t=U(e.data,0,n);return t.$$root=!e.isClone,W(o,t,n,!0)};J.directives={focus:{mounted(e,{value:n}){n&&e.focus()},updated(e,{value:n}){n&&e.focus()}},nodedrag:Y};var H=a({props:{scale:String,tools:Object},setup(e,{emit:n}){const t=l(!1),o=l(!1);const a=r((()=>t.value?"全部收起":"全部展开")),d=r((()=>o.value?"退出全屏":"全屏"));return{expanded:t,fullscreen:o,expandTitle:a,fullTiltle:d,handleExpand:function(){t.value=!t.value,n("onExpand")},handleScale:function(e){"out"===e?n("onScale",.1):"in"===e?n("onScale",-.1):n("onRestore")},handleFullscreen:function(){o.value=!o.value,n("onFullscreen")}}}});const G={class:"zm-tree-handle"},Q={key:0,class:"zm-tree-percent"},Z=["title"],ee={class:"zm-tree-svg"},ne=[i("span",{class:"zm-tree-icon"},"+",-1)],te=[i("span",{class:"zm-tree-icon"},"-",-1)],oe=[i("span",{class:"zm-tree-restore"},null,-1)],ae=["title"],le={class:"zm-tree-svg"};function re(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}function de(e,n,t,o=1){return{deltaX:Math.round(n/o/e[0])*e[0],deltaY:Math.round(t/o/e[1])*e[1]}}function se(e,n,t){return e<n?n:t<e?t:e}H.render=function(e,n,t,o,a,l){return d(),s("div",G,[e.tools.scale?(d(),s("div",Q,c(e.scale),1)):u("v-if",!0),e.tools.expand?(d(),s("div",{key:1,onClick:n[0]||(n[0]=(...n)=>e.handleExpand&&e.handleExpand(...n)),title:e.expandTitle,class:"zm-tree-handle-item"},[i("span",ee,[i("i",{class:p(["iconfont",e.expanded?"icon-collapse":"icon-expand"])},null,2)])],8,Z)):u("v-if",!0),e.tools.zoom?(d(),s("div",{key:2,onClick:n[1]||(n[1]=n=>e.handleScale("out")),title:"放大",class:"zm-tree-handle-item zoom-out"},ne)):u("v-if",!0),e.tools.zoom?(d(),s("div",{key:3,onClick:n[2]||(n[2]=n=>e.handleScale("in")),title:"缩小",class:"zm-tree-handle-item zoom-in"},te)):u("v-if",!0),e.tools.restore?(d(),s("div",{key:4,onClick:n[3]||(n[3]=n=>e.handleScale("restore")),title:"还原",class:"zm-tree-handle-item"},oe)):u("v-if",!0),e.tools.fullscreen?(d(),s("div",{key:5,onClick:n[4]||(n[4]=(...n)=>e.handleFullscreen&&e.handleFullscreen(...n)),title:e.fullTiltle,class:"zm-tree-handle-item"},[i("span",le,[i("i",{class:p(["iconfont",e.fullscreen?"icon-unfullscreen":"icon-fullscreen"])},null,2)])],8,ae)):u("v-if",!0)])},H.__file="src/components/tools/tools.vue";const ce=function(e,n,t,o=!1){e&&n&&t&&e.addEventListener(n,t,o)},ue=function(e,n,t,o=!1){e&&n&&t&&e.removeEventListener(n,t,o)},ie=(e,{emit:n},t)=>{const o={start:"mousedown",move:"mousemove",stop:"mouseup"},a={start:"touchstart",move:"touchmove",stop:"touchend"},d={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},s={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let c=o;const u=l(e.x),i=l(e.y),p=l(e.z),y=l(e.active),h=l(!1),b=l(0),x=l(0),N=l(0),$=l(0),D=l(0),C=l(0);let E={},S={};function O(){E={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},S={minLeft:-1/0,maxLeft:1/0,minRight:-1/0,maxRight:1/0,minTop:-1/0,maxTop:1/0,minBottom:-1/0,maxBottom:1/0}}function k(){if(e.parent){const[e,n]=z();D.value=e||0,C.value=n||0}}function z(){if(e.parent&&t.eleRef.value){const e=window.getComputedStyle(t.eleRef.value.parentNode,null);return[parseInt(e.getPropertyValue("width"),10),parseInt(e.getPropertyValue("height"),10)]}return[0,0]}function M(o){if(o instanceof MouseEvent&&1!==o.which)return;const a=o.target||o.srcElement;if(a&&t.eleRef.value&&t.eleRef.value.contains(a)){if(e.dragCancel&&function(e,n,t){let o=e;const a=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find((e=>o&&re(o[e])))||"";if(!re(o[a]))return!1;do{if(o[a](n))return!0;if(o===t)return!1;o=o.parentNode}while(o);return!1}(a,e.dragCancel,t.eleRef.value))return void(h.value=!1);y.value||(y.value=!0,n("activated"),n("update:active",!0)),e.draggable&&(h.value=!0),o instanceof MouseEvent?(E.mouseX=o.pageX,E.mouseY=o.pageY):(E.mouseX=o.touches[0].pageX,E.mouseY=o.touches[0].pageY),E.left=u.value,E.right=b.value,E.top=i.value,E.bottom=x.value,e.parent&&(S=R()),ce(document.documentElement,c.move,w),ce(document.documentElement,c.stop,F)}}function R(){const n=e.grid;return{minLeft:u.value%n[0],maxLeft:Math.floor((D.value-N.value-u.value)/n[0])*n[0]+u.value,minRight:b.value%n[0],maxRight:Math.floor((D.value-N.value-b.value)/n[0])*n[0]+b.value,minTop:i.value%n[1],maxTop:Math.floor((C.value-$.value-i.value)/n[1])*n[1]+i.value,minBottom:x.value%n[1],maxBottom:Math.floor((C.value-$.value-x.value)/n[1])*n[1]+x.value}}function _(o){const a=o.target||o.srcElement;t.eleRef.value&&!t.eleRef.value.contains(a)&&y.value&&!e.preventDeactivation&&(y.value=!1,n("deactivated"),n("update:active",!1))}function w(t){h.value&&function(t){const o=e.axis,a=e.grid;let l=0,r=0;t instanceof MouseEvent?(l=t.pageX,r=t.pageY):(l=t.touches[0].pageX,r=t.touches[0].pageY);const d=o&&"y"!==o?E.mouseX-l:0,s=o&&"x"!==o?E.mouseY-r:0,{deltaX:c,deltaY:p}=de(a,d,s,e.scale),f=se(E.left-c,S.minLeft,S.maxLeft),m=se(E.top-p,S.minTop,S.maxTop),v=se(E.right+c,S.minRight,S.maxRight),g=se(E.bottom+p,S.minBottom,S.maxBottom);u.value=f,i.value=m,b.value=v,x.value=g,n("dragging",u.value,i.value)}(t)}function F(){O(),h.value&&(h.value=!1,n("dragstop",u.value,i.value))}f((()=>{O()})),m((()=>{!e.enableNativeDrag&&t.eleRef.value&&(t.eleRef.value.ondragstart=()=>!1);const[n,o]=z();if(D.value=n,C.value=o,t.eleRef.value){const[e,n]=function(e){const n=window.getComputedStyle(e);return[parseFloat(n.getPropertyValue("width")),parseFloat(n.getPropertyValue("height"))]}(t.eleRef.value);N.value=e,$.value=n,b.value=D.value-N.value-u.value,x.value=C.value-$.value-i.value}ce(document.documentElement,"mousedown",_),ce(document.documentElement,"touchend touchcancel",_),ce(window,"resize",k)})),v((()=>{ue(document.documentElement,"mousedown",_),ue(document.documentElement,"touchstart",F),ue(document.documentElement,"mousemove",w),ue(document.documentElement,"touchmove",w),ue(document.documentElement,"mouseup",F),ue(document.documentElement,"touchend touchcancel",_),ue(window,"resize",k)}));const B=r((()=>({transform:`translate(${u.value}px, ${i.value}px)`,zIndex:p.value,...h.value&&e.disableUserSelect?d:s})));return g((()=>e.active),(e=>{y.value=e,n(e?"activated":"deactivated")})),g((()=>e.z),(e=>{(e>=0||"auto"===e)&&(p.value=e)})),g((()=>e.x),(n=>{h.value||(e.parent&&(S=R()),function(n){const{deltaX:t}=de(e.grid,n,i.value,e.scale),o=se(t,S.minLeft,S.maxLeft);u.value=o,b.value=D.value-N.value-o}(n))})),g((()=>e.y),(n=>{h.value||(e.parent&&(S=R()),function(n){const{deltaY:t}=de(e.grid,u.value,n,e.scale),o=se(t,S.minTop,S.maxTop);i.value=o,x.value=C.value-$.value-o}(n))})),{enabled:y,dragging:h,style:B,resetBoundsAndMouseState:O,elementTouchDown:function(e){c=a,M(e)},elementMouseDown:function(e){c=o,M(e)}}};"production"===process.env.NODE_ENV||Object.freeze({}),"production"===process.env.NODE_ENV||Object.freeze([]);const pe=Symbol("wrapper");function fe(e,n){if(null===(t=e)||"object"!=typeof t||e.__elPropsReservedKey)return e;var t;const{values:o,required:a,default:l,type:r,validator:d}=e,s=o||d?e=>{let t=!1,a=[];if(o&&(a=[...o,l],t=t||a.includes(e)),d&&(t=t||d(e)),!t&&a.length>0){const t=[...new Set(a)].map((e=>JSON.stringify(e))).join(", ");y(`Invalid prop: validation failed${n?` for prop "${n}"`:""}. Expected one of [${t}], got value ${JSON.stringify(e)}.`)}return t}:void 0;return{type:"object"==typeof r&&Object.getOwnPropertySymbols(r).includes(pe)?r[pe]:r,validator:s,__elPropsReservedKey:!0,default:l,required:!!a}}const me=e=>function(e){let n=-1;const t=e?e.length:0,o={};for(;++n<t;){const t=e[n];o[t[0]]=t[1]}return o}(Object.entries(e).map((([e,n])=>[e,fe(n,e)]))),ve=e=>({[pe]:e});var ge=a({replace:!0,name:"Draggable",props:me({className:{type:String,default:"zm-draggable"},classNameDraggable:{type:String,default:"draggable"},classNameDragging:{type:String,default:"dragging"},classNameActive:{type:String,default:"active"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:e=>"string"==typeof e?"auto"===e:e>=0},dragCancel:String,axis:{type:String,default:"both",validator:e=>["x","y","both"].includes(e)},grid:{type:Array,default:()=>[1,1]},parent:{type:Boolean,default:!1},scale:{type:Number,default:1,validator:e=>e>0}}),emits:{activated:()=>!0,deactivated:()=>!0,dragging:(e,n)=>B(e)&&B(n),dragstop:(e,n)=>B(e)&&B(n),"update:active":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=ie(e,n,{eleRef:t});return{top:top,eleRef:t,...o}}});ge.render=function(e,n,t,o,a,l){return d(),s("div",{style:h(e.style),class:p([{[e.classNameActive]:e.enabled,[e.classNameDragging]:e.dragging,[e.classNameDraggable]:e.draggable},e.className]),ref:"eleRef",onMousedown:n[0]||(n[0]=(...n)=>e.elementMouseDown&&e.elementMouseDown(...n)),onTouchstart:n[1]||(n[1]=(...n)=>e.elementTouchDown&&e.elementTouchDown(...n))},[b(e.$slots,"default")],38)},ge.__file="src/components/draggable/src/draggable.vue";var ye=a({components:{TreeOrgNode:J},props:me({data:{type:Object,required:!0},props:{type:ve(Object)},modelValue:Boolean,horizontal:Boolean,selectedKey:String,collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]}})});const he={id:"clone-tree-org",class:"clone-tree-org tree-org"};ye.render=function(t,o,a,l,r,s){const c=x("tree-org-node");return d(),N($,{to:"body"},[e(i("div",he,[D(c,{data:t.data,props:t.props,isClone:!1,horizontal:t.horizontal,labelStyle:t.labelStyle,collapsable:t.collapsable,renderContent:t.renderContent,labelClassName:t.labelClassName},{default:C((({node:e})=>[b(t.$slots,"default",{node:e})])),expand:C((({node:e})=>[b(t.$slots,"expand",{node:e})])),_:3},8,["data","props","horizontal","labelStyle","collapsable","renderContent","labelClassName"])],512),[[n,t.modelValue]])])},ye.__file="src/components/clone-org/clone-org.vue";const be=(e,{emit:n},t)=>{const o=l("");function a(e,n,t){if(e[n]===t)return e;if(Array.isArray(e.children)){const o=e.children;for(let e=0,l=o.length;e<l;e++){const l=a(o[e],n,t);if(l)return l}}}function d(){const{props:t,data:o,node:l}=e;if(e.nodeDelete)return void e.nodeDelete(l.$$data);if(l.$$root)return void A.pretty("[提示] ","根节点不允许删除","danger");const{id:r,children:d}=t,s=a(o,r,l.pid);if(s){const e=s[d];for(let t=0,o=e.length;t<o;t++)if(e[t][r]===l.id){e.splice(t,1),n("onNodeDelete",l.$$data,l);break}}}function s(){const{nodeEdit:t,node:o}=e;t?t(o.$$data):n("onNodeFocus",o.$$data)}function c(o){if(e.modelValue){if(t.eleRef.value&&t.eleRef.value.contains(o.target))return!1;n("update:modelValue",!1)}}const u=r((()=>({left:`${e.x}px`,top:`${e.y}px`}))),i=r((()=>!e.disabled&&!e.node.disabled));return m((()=>{document.addEventListener("mousedown",c)})),v((()=>{document.removeEventListener("mousedown",c)})),{position:u,editable:i,handleMenu:function(a){const l=a.target;if("zm-tree-menu-item"===l.className){const a=l.getAttribute("action");switch(a){case"copy":!function(){if(e.nodeCopy)return void e.nodeCopy(e.node.$$data);o.value=e.node.label,E((()=>{t.inputRef&&t.inputRef.value&&(t.inputRef&&t.inputRef.value.select(),navigator.clipboard.writeText(o.value).then((function(){A.pretty("[提示] ","文本复制成功","success")}),(function(){A.pretty("[错误] ","浏览器不支持","danger")})),n("onNodeCopy",o.value))}))}();break;case"add":!function(){if(e.nodeAdd)return void e.nodeAdd(e.node.$$data);const{id:t,pid:o,label:a,expand:l,children:r}=e.props,{node:d}=e,s={[t]:String((new Date).getTime()),[o]:d.id,[a]:"",[l]:!1,[r]:[],newNode:!0,focused:!0};Array.isArray(d.children)?d.$$data[r].push(s):d.$$data[r]=[s];n("onNodeFocus",s)}();break;case"edit":s();break;case"delete":d()}n("contextmenu",{command:a,node:e.node,data:e.node.$$data}),n("update:modelValue",!1)}},handleEdit:s,handleClose:c,afterEnter:function(){n("opened")},afterLeave:function(){n("closed")}}};var xe=a({name:"Contextmenu",props:me({modelValue:{type:Boolean,required:!0},data:{type:Object,required:!0},node:{type:ve(Object),required:!0},props:{type:ve(Object)},x:Number,y:Number,menus:{type:ve(Array)},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,disabled:Boolean}),emits:{onNodeDelete:(e,n)=>w(e)&&w(n),onNodeCopy:e=>F(e),contextmenu:e=>w(e),onNodeFocus:e=>w(e),opened:()=>!0,closed:()=>!0,"update:modelValue":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=l();return{eleRef:o,inputRef:t,copyText:l(""),oldData:S({}),...be(e,n,{inputRef:t,eleRef:o})}}});const Ne=["action"];xe.render=function(t,o,a,l,r,p){return d(),N($,{to:"body"},[D(O,{name:"dialog-fade",onAfterEnter:t.afterEnter,onAfterLeave:t.afterLeave},{default:C((()=>[e(i("div",{style:h(t.position),onClick:o[1]||(o[1]=(...e)=>t.handleMenu&&t.handleMenu(...e)),ref:"eleRef",class:"zm-tree-contextmenu"},[i("ul",null,[(d(!0),s(k,null,z(t.menus,(e=>(d(),s(k,null,[t.editable||!["add","edit","delete"].includes(e.command)?(d(),s("li",{class:"zm-tree-menu-item",action:e.command,key:e.command},c(e.name),9,Ne)):u("v-if",!0)],64)))),256))]),e(i("textarea",{class:"copy-textarea",ref:"inputRef","onUpdate:modelValue":o[0]||(o[0]=e=>t.copyText=e)},null,512),[[M,t.copyText]])],4),[[n,t.modelValue]])])),_:1},8,["onAfterEnter","onAfterLeave"])])},xe.__file="src/components/contextmenu/src/contextmenu.vue";const $e=[{name:"复制文本",command:"copy"},{name:"新增节点",command:"add"},{name:"编辑节点",command:"edit"},{name:"删除节点",command:"delete"}],De=me({data:{type:Object,required:!0},props:{type:ve(Object),default:()=>({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"})},toolBar:{type:[Object,Boolean],default:()=>({expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0})},disabled:{type:Boolean,default:!1},scalable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},draggableOnNode:{type:Boolean,default:!1},nodeDraggable:{type:Boolean,default:!0},cloneNodeDrag:{type:Boolean,default:!0},onlyOneNode:{type:Boolean,default:!0},clickDelay:{type:Number,default:260},defaultExpandLevel:Number,nodeDragStart:Function,nodeDraging:Function,nodeDragEnd:Function,horizontal:Boolean,selectedKey:{type:[Array,String,Number]},collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]},selectedClassName:{type:[Function,String]},defineMenus:{type:ve(Array),default:()=>$e},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function}),Ce=(e,{emit:n},t)=>{const o=l(0),a=l(0),d=l(!1);function s(e,n){const l=t.zoomRef.value,r=t.treeRef.value,d=l.clientWidth/2,s=l.clientHeight/2;let c=l.clientHeight-r.clientHeight,u=l.clientWidth-r.clientWidth;c>0&&(c=0),u>0&&(u=0),o.value=e>d?d:e<u?u:e,a.value=n<c?c:n>s?s:n}function c(e,t){s(e,t),n("on-drag-stop",{x:e,y:t})}const u=l(!1),i=S({value:{}});const p=l(!1),m=l(0),v=l(0),y=l({});const h=l(1);function b(n){if(!e.scalable)return;const t=Number((Number(h.value)+n).toFixed(1));h.value=n>0?Math.min(3,t):Math.max(.3,t)}function x(e,n,t){d.value=!0;const l=e.offsetLeft-n,r=e.offsetTop-t;o.value-=l,a.value-=r,s(o.value,a.value)}let N;const $=S(Object.assign({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"},e.props));const D=l(!1);function C(e){const{expand:n,children:t}=$;e.forEach((e=>{e[n]&&(e[n]=!1),e[t]&&C(e[t])}))}const O=l(!1);function k(e,n){const{expand:t,children:o}=$;Array.isArray(e)?e.forEach((e=>{e[t]=n,e[o]&&k(e[o],n)})):(e[t]=n,e[o]&&k(e[o],n))}const z=l(null);const M=r((()=>({width:100/h.value+"%",height:100/h.value+"%",transform:`scale(${h.value})`}))),R=r((()=>`${Math.round(100*h.value)}%`)),_=r((()=>e.draggableOnNode||!e.nodeDraggable?"":".tree-org-node-label")),w=r((()=>O.value?"收起全部节点":"展开全部节点")),F=r((()=>O.value?"收起全部节点":"展开全部节点")),B=l({}),A=r((()=>{const{cloneNodeDrag:n,onlyOneNode:t,data:o}=e;return{drag:e.nodeDraggable,dragData:{keys:$,nodeMoving:u,parenNode:i,cloneNodeDrag:n,onlyOneNode:t,contextmenu:p,cloneData:B,data:o},handleStart:e.nodeDragStart,handleMove:e.nodeDraging,handleEnd:e.nodeDragEnd}}));g((()=>e.horizontal),(()=>{E((()=>{c(o.value,a.value)}))}));const T=l(e.data);g((()=>e.data),(()=>{T.value=e.data}));const j=S({visible:!0,data:{expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0}});return f((()=>{"object"==typeof e.toolBar?Object.assign(j.data,e.toolBar):e.toolBar||(j.visible=!1)})),{keys:$,left:o,top:a,menuX:m,menuY:v,nodeMoving:u,zoomStyle:M,tools:j,zoomPercent:R,dragCancel:_,expandTitle:w,fullTiltle:F,nodeargs:A,expanded:O,fullscreen:D,treeData:T,autoDragging:d,contextmenu:p,menuData:y,cloneData:B,focusedId:z,zoomWheel:function(t){e.scalable&&(t.preventDefault(),t.deltaY<0?b(.1):b(-.1),n("on-zoom",h.value))},onDrag:function(e,t){d.value=!1,o.value=e,a.value=t,n("on-drag",{x:e,y:t})},onDragStop:c,expandChange:function(){O.value=!O.value,k(e.data,O.value),O.value||E((()=>{c(o.value,a.value)}))},handleFullscreen:function(){D.value=!D.value,D.value?function(){const e=t.eleRef.value;e.requestFullscreen&&e.requestFullscreen()}():document.exitFullscreen&&document.exitFullscreen()},zoomOrgchart:b,restoreOrgchart:function(){h.value=1,o.value=0,a.value=0},handleExpand:function(e,t){e.stopPropagation();const o=document.querySelector(".is-root");if(o){const a=o.offsetLeft,l=o.offsetTop,r=t.$$data,{expand:d,children:s}=$;d in r?(r[d]=!r[d],!r[d]&&r[s]&&C(r[s])):r[d]=!0,E((()=>{x(o,a,l)})),n("on-expand",e,t.$$data,t)}},nodeMouseenter:function(e,t){return u.value&&(i.value=t),n("on-node-mouseenter",e,t.$$data,t),!0},nodeMouseleave:function(e,t){return u.value&&(i.value=null),n("on-node-mouseleave",e,t.$$data,t),!0},nodeContextmenu:function(e,n){e.stopPropagation(),e.preventDefault(),p.value=!0,m.value=e.clientX,v.value=e.clientY,y.value=n},handleBlur:function(e,t){const{id:o,label:a}=$,l=y.value.children||[];for(let e=l.length;e>0;e--){const n=l[e-1];if(""===n[o]&&""===n[a]){l.splice(e-1,1);break}}z.value=null,n("on-node-blur",e,t.$$data,t)},handleClick:function(t,o){clearTimeout(N),N=setTimeout((()=>{n("on-node-click",t,o.$$data,o)}),e.clickDelay)},nodeFocus:function(e){z.value=e[$.id]},handleDblclick:function(e,t){clearTimeout(N),n("on-node-dblclick",e,t.$$data,t)}}};var Ee=a({name:"vue3TreeOrg",components:{Tools:H,CloneOrg:ye,Draggable:ge,Contextmenu:xe,TreeOrgNode:J},directives:{nodedrag:Y},props:De,emits:{"on-drag":({x:e,y:n})=>B(e)&&B(n),"on-drag-stop":({x:e,y:n})=>B(e)&&B(n),"on-zoom":e=>B(e),"on-expand":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-node-blur":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-node-click":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-node-dblclick":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-node-mouseenter":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-node-mouseleave":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n),"on-contextmenu":e=>w(e),"on-node-copy":e=>F(e),"on-node-delete":e=>w(e),"on-node-focus":(e,n,t)=>e instanceof MouseEvent&&w(t)&&w(n)},setup(e,n){const t=l(),o=l(),a=l();return{eleRef:t,treeRef:o,zoomRef:a,...Ce(e,n,{eleRef:t,treeRef:o,zoomRef:a})}}});const Se={ref:"eleRef",class:"zm-tree-org"},Oe={class:"tree-org-node__text"},ke=i("span",{class:"tree-org-node__expand-btn"},null,-1),ze={class:"tree-org-node__text"},Me=i("span",{class:"tree-org-node__expand-btn"},null,-1);Ee.render=function(e,n,t,o,a,l){const r=x("tree-org-node"),f=x("Draggable"),m=x("Tools"),v=x("clone-org"),g=x("Contextmenu");return d(),s("div",Se,[i("div",{ref:"zoomRef",class:"zoom-container",style:h(e.zoomStyle),onWheel:n[1]||(n[1]=(...n)=>e.zoomWheel&&e.zoomWheel(...n))},[D(f,{x:e.left,y:e.top,class:p({dragging:e.autoDragging}),onDragging:e.onDrag,onDragstop:e.onDragStop,draggable:e.draggable,"drag-cancel":e.dragCancel},{default:C((()=>[i("div",{ref:"treeRef",class:p(["tree-org",{horizontal:e.horizontal,collapsable:e.collapsable}])},[D(r,{data:e.treeData,props:e.keys,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,selectedKey:e.selectedKey,defaultExpandLevel:e.defaultExpandLevel,selectedClassName:e.selectedClassName,labelClassName:e.labelClassName,vNodedrag:e.nodeargs,focused:e.focusedId,onOnExpand:e.handleExpand,onNodeClick:e.handleClick,onNodeDblclick:e.handleDblclick,onNodeMouseenter:e.nodeMouseenter,onNodeMouseleave:e.nodeMouseleave,onNodeContextmenu:e.nodeContextmenu,onNodeFocus:n[0]||(n[0]=(n,t)=>{e.$emit("on-node-focus",n,t)}),onNodeBlur:e.handleBlur},{default:C((({node:n})=>[b(e.$slots,"default",{node:n},(()=>[i("div",Oe,[i("span",null,c(n.label),1)])]))])),expand:C((({node:n})=>[b(e.$slots,"expand",{node:n},(()=>[ke]))])),_:3},8,["data","props","horizontal","labelStyle","collapsable","renderContent","selectedKey","defaultExpandLevel","selectedClassName","labelClassName","vNodedrag","focused","onOnExpand","onNodeClick","onNodeDblclick","onNodeMouseenter","onNodeMouseleave","onNodeContextmenu","onNodeBlur"])],2)])),_:3},8,["x","y","class","onDragging","onDragstop","draggable","drag-cancel"])],36),e.tools.visible?(d(),N(m,{key:0,tools:e.tools.data,scale:e.zoomPercent,onOnExpand:e.expandChange,onOnScale:e.zoomOrgchart,onOnRestore:e.restoreOrgchart,onOnFullscreen:e.handleFullscreen},null,8,["tools","scale","onOnExpand","onOnScale","onOnRestore","onOnFullscreen"])):u("v-if",!0),e.nodeDraggable?(d(),N(v,{key:1,modelValue:e.nodeMoving,"onUpdate:modelValue":n[2]||(n[2]=n=>e.nodeMoving=n),props:e.keys,data:e.cloneData,horizontal:e.horizontal,"label-style":e.labelStyle,collapsable:e.collapsable,"render-content":e.renderContent,"label-class-name":e.labelClassName},{default:C((({node:n})=>[b(e.$slots,"default",{node:n},(()=>[i("div",ze,[i("span",null,c(n[e.keys.label]),1)])]))])),expand:C((({node:n})=>[b(e.$slots,"expand",{node:n},(()=>[Me]))])),_:3},8,["modelValue","props","data","horizontal","label-style","collapsable","render-content","label-class-name"])):u("v-if",!0),e.defineMenus.length?(d(),N(g,{key:2,modelValue:e.contextmenu,"onUpdate:modelValue":n[3]||(n[3]=n=>e.contextmenu=n),x:e.menuX,y:e.menuY,node:e.menuData,data:e.data,props:e.keys,menus:e.defineMenus,disabled:e.disabled,"node-add":e.nodeAdd,"node-delete":e.nodeDelete,"node-edit":e.nodeEdit,"node-copy":e.nodeCopy,onContextmenu:n[4]||(n[4]=n=>{e.$emit("on-contextmenu",n)}),onOnNodeFocus:e.nodeFocus,onOnNodeCopy:n[5]||(n[5]=n=>{e.$emit("on-node-copy",n)}),onOnNodeDelete:n[6]||(n[6]=n=>{e.$emit("on-node-delete",n)})},null,8,["modelValue","x","y","node","data","props","menus","disabled","node-add","node-delete","node-edit","node-copy","onOnNodeFocus"])):u("v-if",!0)],512)},Ee.__file="src/components/tree-org/src/tree.vue",Ee.install=function(e){e.component(Ee.name,Ee)};const Re=[Ee];var _e={install:function(e){Re.forEach((n=>{e.component(n.name,n)})),e.use(j)},Vue3TreeOrg:Ee};export{Ee as Vue3TreeOrg,_e as default};
